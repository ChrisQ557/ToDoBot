{% extends 'base.html' %}
{% block content %}
  <h2>Create Task</h2>
  <form method="post">
    {% csrf_token %}
    {% if form.errors %}
      <div class="alert alert-danger">
        <ul>
        {% for field in form %}
          {% for error in field.errors %}
            <li>{{ field.label }}: {{ error }}</li>
          {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
          <li>{{ error }}</li>
        {% endfor %}
        </ul>
      </div>
    {% endif %}
    <div id="task-form-fields">
      {{ form.title.label_tag }} {{ form.title }}<br>
      {{ form.description.label_tag }} {{ form.description }}<br>
      {{ form.category.label_tag }} {{ form.category }}<br>
      {{ form.scheduled_time.label_tag }} {{ form.scheduled_time }}<br>
      {{ form.is_completed.label_tag }} {{ form.is_completed }}<br>
      {{ form.task_type.label_tag }} {{ form.task_type }}<br>
      <div id="recurrence-fields">
        {{ form.recurrence_time.label_tag }} {{ form.recurrence_time }}<br>
        {{ form.recurrence_days.label_tag }} {{ form.recurrence_days }}<br>
      </div>
    </div>
    <button type="submit" class="btn btn-primary">Create</button>
  </form>
  <a href="{% url 'home' %}">Back to Task List</a>
  {% load static %}
  <script src="{% static 'js/script.js' %}"></script>
  <script>
    function toggleRecurrenceFields() {
      var taskType = document.getElementById('id_task_type');
      var recurrenceFields = document.getElementById('recurrence-fields');
      if (taskType && recurrenceFields) {
        if (taskType.value === 'automation') {
          recurrenceFields.style.display = 'block';
        } else {
          recurrenceFields.style.display = 'none';
        }
      }
    }
    document.addEventListener('DOMContentLoaded', function() {
      var taskType = document.getElementById('id_task_type');
      if (taskType) {
        taskType.addEventListener('change', toggleRecurrenceFields);
        toggleRecurrenceFields();
      }
    });
  </script>
{% endblock %}
